<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sa√∫de da Crian√ßa</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos espec√≠ficos para Vacina√ß√£o */
        .filter-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .filter-btn { flex: 1; padding: 10px; border: 1px solid #ddd; background: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; color: #666; transition: all 0.2s; }
        .filter-btn.active { background: #EC407A; color: white; border-color: #EC407A; box-shadow: 0 4px 10px rgba(236, 64, 122, 0.3); }
        
        .vac-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 5px solid #EC407A; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .vac-title { font-weight: 800; font-size: 1rem; color: #333; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .vac-subtitle { font-size: 0.85rem; color: #666; font-weight: 600; margin-bottom: 8px; display: block; }
        .vac-detail { font-size: 0.9rem; color: #444; background: #FCE4EC; padding: 8px; border-radius: 6px; margin-top: 5px; }
        .vac-obs { font-size: 0.8rem; color: #888; font-style: italic; margin-top: 5px; }

        /* Estilo Macetes */
        .macete-box { background: #E3F2FD; border: 2px dashed #64B5F6; border-radius: 12px; padding: 15px; margin-bottom: 20px; display: none; }
        .macete-item { margin-bottom: 8px; font-size: 0.95rem; color: #1565C0; }
        .macete-tag { background: #1976D2; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-right: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <header class="app-header">
        <button class="back-btn" onclick="goBack()" id="backBtn">‚¨Ö</button>
        <div class="app-title">Sa√∫de da Crian√ßa üë∂</div>
    </header>

    <div class="container">

        <section id="view-crianca-menu" class="view-section" style="display: block;">
            <div class="menu-grid">
                <div class="menu-card border-ped" onclick="navigateTo('view-ped-antropometria')">
                    <span class="card-icon">üìè</span>
                    <div class="card-title">Dados Antropom√©tricos (OMS)</div>
                </div>
                <div class="menu-card border-ped" onclick="navigateTo('view-ped-vacinas')">
                    <span class="card-icon">üíâ</span>
                    <div class="card-title">Vacina√ß√£o<br><small>Calend√°rio & Macetes</small></div>
                </div>
            </div>
        </section>

        <section id="view-ped-antropometria" class="view-section">
            <div class="calc-box">
                <h3>Dados Antropom√©tricos (OMS)</h3>
                <form onsubmit="event.preventDefault(); runCalculoZ();">
                    <div style="background:#FFF8E1; padding:15px; border-radius:12px; margin-bottom:20px; border:1px solid #FFE0B2;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div><label>Nascimento</label><input type="date" id="ped-dob" required></div>
                            <div><label>Consulta</label><input type="date" id="ped-visit" required></div>
                        </div>
                        <div id="ped-age-display" style="text-align:center; font-weight:bold; color:#F57C00; margin-top:5px; font-size:0.95rem;"></div>
                    </div>
                    <label>Sexo</label><select id="ped-sex"><option value="BOYS">Masculino</option><option value="GIRLS">Feminino</option></select>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div><label>Peso (kg)</label><input type="number" id="ped-w" step="0.001" required></div>
                        <div><label>Estatura (cm)</label><input type="number" id="ped-h" step="0.1" required></div>
                    </div>
                    <label>Per√≠metro Cef√°lico (cm)</label><input type="number" id="ped-hc" step="0.1">
                    <button class="btn-calc" style="background:var(--primary);">Calcular e Classificar</button>
                </form>
                <div id="ped-res-area" class="result-box">
                    <h4 style="margin:0 0 15px 0; color:var(--primary);">RESULTADOS</h4>
                    <div id="ped-zscore-results"></div>
                </div>
            </div>
        </section>

        <section id="view-ped-vacinas" class="view-section">
            <div class="calc-box">
                <h3 style="color:#D81B60;">üíâ Calend√°rio Nacional</h3>
                
                <div class="filter-container">
                    <button class="filter-btn active" onclick="setVacMode('idade', this)">Por Idade</button>
                    <button class="filter-btn" onclick="setVacMode('vacina', this)">Por Vacina</button>
                    <button class="filter-btn" style="background:#E3F2FD; color:#1565C0; border-color:#90CAF9;" onclick="toggleMacetes()">üí° Macetes</button>
                </div>

                <div id="macetes-box" class="macete-box">
                    <h4 style="margin-top:0; color:#0D47A1;">Mnem√¥nicos de Vacina√ß√£o</h4>
                    <div class="macete-item"><span class="macete-tag">Ao Nascer</span> BB (BCG + Hep B)</div>
                    <div class="macete-item"><span class="macete-tag">2 Meses</span> 4 Ps: Penta, Polio (VIP), Pneumo, Piriri (Rota)</div>
                    <div class="macete-item"><span class="macete-tag">3 Meses</span> 3 invertido vira M (Meningo C)</div>
                    <div class="macete-item"><span class="macete-tag">4 Meses</span> Repete 2¬∫ m√™s (4 Ps)</div>
                    <div class="macete-item"><span class="macete-tag">5 Meses</span> Repete 3¬∫ m√™s (Meningo C)</div>
                    <div class="macete-item"><span class="macete-tag">6 Meses</span> "COm 6": COVID + (5+1) -> Penta + VIP</div>
                    <div class="macete-item"><span class="macete-tag">7 Meses</span> 2¬™ Dose COVID</div>
                    <div class="macete-item"><span class="macete-tag">9 Meses</span> Febre Amarela</div>
                    <div class="macete-item"><span class="macete-tag">12 Meses</span> TPM (Tr√™s Melhores Presentes): Tr√≠plice, Pneumo 10, Meningo C</div>
                    <div class="macete-item"><span class="macete-tag">15 Meses</span> A Debutante Vira Tequila: Hep A, DTP, VIP, Tetraviral</div>
                    <div class="macete-item"><span class="macete-tag">4 Anos</span> Depois FAz Vacina: DTP, Febre Amarela, Varicela</div>
                    <div class="macete-item"><span class="macete-tag">9-14 Anos</span> HPV (Meninos e Meninas)</div>
                </div>

                <div id="vac-list"></div>
            </div>
        </section>

    </div>

    <footer>
        Cerebro de √Åtila (R) 2025. Direitos reservados.
    </footer>

    <script src="dados_oms.js"></script>

    <script>
        // --- NAVEGA√á√ÉO ---
        let stack = ['view-crianca-menu'];
        function navigateTo(id) {
            document.querySelectorAll('.view-section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            stack.push(id);
            window.scrollTo(0,0);
        }
        function goBack() {
            if(stack.length > 1) {
                stack.pop();
                document.querySelectorAll('.view-section').forEach(s => s.style.display = 'none');
                document.getElementById(stack[stack.length-1]).style.display = 'block';
            } else {
                window.location.href = 'index.html';
            }
        }

        // --- DADOS DE VACINA√á√ÉO ---
        const VACINAS = [
            { id: 1, nome: "BCG", idade: "Ao Nascer", esquema: "Dose √önica", obs: "Formas graves de TB. Cicatriz vacinal.", simultaneo: "Sim" },
            { id: 2, nome: "Hepatite B", idade: "Ao Nascer", esquema: "Dose ao nascer", obs: "Preferencialmente nas primeiras 12h.", simultaneo: "Sim" },
            { id: 3, nome: "Penta (DTP+Hib+HepB)", idade: "2, 4, 6 Meses", esquema: "3 Doses", obs: "Intervalo de 60 dias (m√≠n 30).", simultaneo: "Sim" },
            { id: 4, nome: "VIP (P√≥lio Inativada)", idade: "2, 4, 6 Meses", esquema: "3 Doses", obs: "Refor√ßos com VOP ou VIP.", simultaneo: "Sim" },
            { id: 5, nome: "VORH (Rotav√≠rus)", idade: "2, 4 Meses", esquema: "2 Doses", obs: "Limite 1¬™ dose: 3m15d. Limite 2¬™: 7m29d.", simultaneo: "Sim" },
            { id: 6, nome: "Pneumoc√≥cica 10v", idade: "2, 4, 12 Meses", esquema: "2 Doses + Refor√ßo", obs: "Protege contra otite, pneumonia, meningite.", simultaneo: "Sim" },
            { id: 7, nome: "Meningoc√≥cica C", idade: "3, 5, 12 Meses", esquema: "2 Doses + Refor√ßo", obs: "Refor√ßo preferencialmente com ACWY aos 11-14 anos.", simultaneo: "Sim" },
            { id: 8, nome: "COVID-19", idade: "6, 7, 9 Meses", esquema: "3 Doses", obs: "Esquema Pfizer Baby.", simultaneo: "Sim" },
            { id: 9, nome: "Febre Amarela", idade: "9 Meses, 4 Anos", esquema: "1 Dose + Refor√ßo", obs: "√Åreas end√™micas e recomenda√ß√£o nacional.", simultaneo: "Sim (exceto tr√≠plice <2 anos)" },
            { id: 10, nome: "Tr√≠plice Viral (SCR)", idade: "12 Meses", esquema: "1¬™ Dose", obs: "Sarampo, Caxumba, Rub√©ola. 2¬™ dose como Tetraviral.", simultaneo: "Sim (exceto FA <2 anos)" },
            { id: 11, nome: "Hepatite A", idade: "15 Meses", esquema: "Dose √önica", obs: "At√© 5 anos incompleto.", simultaneo: "Sim" },
            { id: 12, nome: "DTP (Tr√≠plice Bacteriana)", idade: "15 Meses, 4 Anos", esquema: "2 Refor√ßos", obs: "Refor√ßo da Penta.", simultaneo: "Sim" },
            { id: 13, nome: "VOP (P√≥lio Oral)", idade: "15 Meses, 4 Anos", esquema: "2 Refor√ßos", obs: "Gotinha. Evitar se imunossupress√£o.", simultaneo: "Sim" },
            { id: 14, nome: "Tetraviral (SCR-V)", idade: "15 Meses", esquema: "Dose √önica", obs: "Substitui a 2¬™ dose de Tr√≠plice + 1¬™ de Varicela.", simultaneo: "Sim" },
            { id: 15, nome: "Varicela", idade: "4 Anos", esquema: "2¬™ Dose", obs: "A 1¬™ dose foi na Tetraviral.", simultaneo: "Sim" },
            { id: 16, nome: "HPV", idade: "9 a 14 Anos", esquema: "Dose √önica", obs: "Meninos e Meninas. Previne c√¢ncer de colo e verrugas.", simultaneo: "Sim" },
            { id: 17, nome: "Meningo ACWY", idade: "11 a 14 Anos", esquema: "Dose √önica", obs: "Refor√ßo ou dose √∫nica na adolesc√™ncia.", simultaneo: "Sim" }
        ];

        // --- L√ìGICA DE EXIBI√á√ÉO ---
        let currentMode = 'idade';

        function setVacMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderVacList();
        }

        function toggleMacetes() {
            const box = document.getElementById('macetes-box');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        function renderVacList() {
            const container = document.getElementById('vac-list');
            let html = "";

            if (currentMode === 'idade') {
                // Agrupar por idade (simula√ß√£o baseada na lista)
                // Para simplificar, vou criar a lista ordenada cronologicamente
                const cronograma = [
                    { t: "Ao Nascer", v: [1, 2] },
                    { t: "2 Meses", v: [3, 4, 5, 6] },
                    { t: "3 Meses", v: [7] },
                    { t: "4 Meses", v: [3, 4, 5, 6] },
                    { t: "5 Meses", v: [7] },
                    { t: "6 Meses", v: [3, 4, 8] },
                    { t: "7 Meses", v: [8] },
                    { t: "9 Meses", v: [9, 8] },
                    { t: "12 Meses (1 Ano)", v: [10, 6, 7] },
                    { t: "15 Meses", v: [11, 12, 13, 14] },
                    { t: "4 Anos", v: [12, 13, 9, 15] },
                    { t: "9 a 14 Anos", v: [16, 17] }
                ];

                cronograma.forEach(grupo => {
                    let vacinasHTML = "";
                    grupo.v.forEach(vid => {
                        const vac = VACINAS.find(v => v.id === vid);
                        vacinasHTML += `
                            <div style="border-top:1px solid #eee; padding:8px 0; margin-top:5px;">
                                <div style="font-weight:bold; color:#444;">${vac.nome}</div>
                                <div style="font-size:0.85rem; color:#666;">Simult√¢neo: ${vac.simultaneo}</div>
                            </div>`;
                    });

                    html += `
                        <div class="vac-card">
                            <div class="vac-title">${grupo.t}</div>
                            ${vacinasHTML}
                        </div>`;
                });

            } else {
                // Mostrar por Vacina (A-Z ou ID)
                VACINAS.forEach(vac => {
                    html += `
                        <div class="vac-card" style="border-left-color:#7E57C2;">
                            <div class="vac-title">${vac.nome}</div>
                            <span class="vac-subtitle">Idade: ${vac.idade}</span>
                            <div class="vac-detail">
                                <strong>Esquema:</strong> ${vac.esquema}<br>
                                <div class="vac-obs">${vac.obs}</div>
                            </div>
                        </div>`;
                });
            }

            container.innerHTML = html;
        }

        // Inicializar lista
        renderVacList();

        // --- L√ìGICA DE ANTROPOMETRIA (C√ìDIGO ANTERIOR MANTIDO) ---
        // (Copie aqui a fun√ß√£o runCalculoZ() do c√≥digo anterior ou mantenha se j√° estiver no arquivo)
        // ... (Seu c√≥digo de Z-Score continua funcionando igual) ...
        document.getElementById('ped-visit').valueAsDate = new Date();

        function runCalculoZ() {
            if (typeof window.OMS_TABLES === 'undefined') {
                alert("Erro: Banco de dados OMS n√£o carregado.");
                return;
            }
            const dob = new Date(document.getElementById('ped-dob').value);
            const visit = new Date(document.getElementById('ped-visit').value);
            const sex = document.getElementById('ped-sex').value;
            const w = parseFloat(document.getElementById('ped-w').value);
            const h = parseFloat(document.getElementById('ped-h').value);
            const hc = parseFloat(document.getElementById('ped-hc').value);

            if (dob >= visit) { alert("Data de nascimento inv√°lida."); return; }

            const diffDays = Math.floor((visit - dob) / 86400000);
            const diffMonths = diffDays / 30.4375;
            const y = Math.floor(diffDays / 365.25);
            const m = Math.floor((diffDays % 365.25) / 30.4375);
            const d = Math.floor((diffDays % 365.25) % 30.4375);
            document.getElementById('ped-age-display').innerText = `${y} anos, ${m} meses e ${d} dias`;

            const isOver5 = diffDays > 1856;
            const getParams = (key, t) => {
                const tbl = window.OMS_TABLES[key];
                if(!tbl) return null;
                const k = Math.floor(t).toString();
                const d = tbl[k] || tbl[Object.keys(tbl).pop()];
                return {L:d[0], M:d[1], S:d[2]};
            };
            const calc = (val, p) => p ? ((Math.pow(val/p.M, p.L)-1)/(p.L*p.S)) : null;

            let html = "";
            const wTab = isOver5 ? `WFA_${sex}_5_10` : `WFA_${sex}`;
            html += zCard("Peso/Idade", calc(w, getParams(wTab, isOver5?diffMonths:diffDays)), 'wfa');
            
            const hTab = isOver5 ? `HFA_${sex}_5_19` : `LHFA_${sex}`;
            html += zCard("Estatura/Idade", calc(h, getParams(hTab, isOver5?diffMonths:diffDays)), 'hfa');
            
            const bmi = w/((h/100)**2);
            const bTab = isOver5 ? `BFA_${sex}_5_19` : `BFA_${sex}`;
            html += zCard("IMC/Idade", calc(bmi, getParams(bTab, isOver5?diffMonths:diffDays)), 'bmi');

            if(hc && !isOver5) html += zCard("Per√≠metro Cef√°lico", calc(hc, getParams(`HCFA_${sex}`, diffDays)), 'hc');

            document.getElementById('ped-zscore-results').innerHTML = html;
            document.getElementById('ped-res-area').style.display = 'block';
        }

        function zCard(t, z, type) {
            if(z===null || isNaN(z)) return "";
            let l="", c="c-green";
            if(type==='wfa'){ if(z<-3){l="Muito baixo peso";c="c-red"} else if(z<-2){l="Baixo peso";c="c-orange"} else if(z>2){l="Peso elevado";c="c-orange"} else l="Peso adequado"; }
            else if(type==='hfa'){ if(z<-3){l="Muito baixa est.";c="c-red"} else if(z<-2){l="Baixa est.";c="c-orange"} else l="Adequada"; }
            else if(type==='bmi'){ if(z<-3){l="Magreza acentuada";c="c-red"} else if(z<-2){l="Magreza";c="c-orange"} else if(z<=1) l="Eutrofia"; else if(z<=2){l="Risco sobrepeso";c="c-orange"} else if(z<=3){l="Sobrepeso";c="c-orange"} else {l="Obesidade";c="c-red"} }
            else { if(z<-2){l="Microcefalia";c="c-red"} else if(z>2){l="Macrocefalia";c="c-red"} else l="Adequado"; }
            return `<div class="z-result-card ${c}"><div class="z-info"><span class="z-title">${t}</span><span class="z-val">Z: ${z.toFixed(2)}</span></div><div class="z-tag">${l}</div></div>`;
        }
    </script>
</body>
</html>